# 配信ピックアップ（/broadcast）

**ユーザーが以下のコマンドを入力したときにこのスキルを実行:**

- `/broadcast`
- `/配信`
- `/ピックアップ`

## このスキルの目的

Notionの案件DB・要員DBから「営業中」のレコードを取得し、魅力度スコアリングを行い、パートナーへの配信候補をチャット上に表示する。ユーザーが確認・調整した後、承認するとGAS WebApp経由でLINE配信を実行する。

## 処理フロー

### 1. スコアリング実行

```bash
cd C:\Users\user\claude-workspace\line-notion-matching\broadcast-skill
python broadcast.py [--top 3] [--type all]
```

- `--top`: 案件・要員それぞれの上位N件をピックアップ（デフォルト: 3）
- `--threshold`: 最低スコア足切り（デフォルト: 0＝足切りなし）
- `--type`: `all`（案件+要員）、`cases`（案件のみ）、`staff`（要員のみ）

### 2. 結果の表示

スクリプトは JSON 形式で結果を出力する。チャット上では以下の形式で表示する。

**表示項目（案件・要員共通）:**
- タイトル（案件名 / 要員名）
- スコア（総合点/100）
- 内訳（各軸のスコア）
- サマリー（**必ず全文表示。省略・要約は禁止**）
- 元企業名（案件元企業 / 要員元企業）

**上記以外の項目（単価、スキル、リモート、年齢、SS有無など）はサマリー内に含まれるため個別表示しない。**

```
配信候補をピックアップしました

━━━━━━━━━━━━━━━━━━
【案件1】案件名 — スコア: XX/100
内訳: 単価XX/30 言語XX/20 鮮度XX/25 リモートXX/25
元企業: XXXXX
━━━━━━━━━━━━━━━━━━
（サマリー全文をそのまま表示）

━━━━━━━━━━━━━━━━━━
【要員1】要員名 — スコア: XX/100
内訳: 年齢XX/25 単価XX/25 鮮度XX/25 言語XX/15 SSXX/10
元企業: XXXXX
━━━━━━━━━━━━━━━━━━
（サマリー全文をそのまま表示）

配信してよいですか？（個別に除外したい場合は番号を指定）
```

### 3. ユーザー承認

- ユーザーが「OK」「送って」→ GAS WebApp呼び出しへ進む
- ユーザーが「案件1は外して」→ 除外して再表示
- ユーザーが「やめる」→ 中止

### 4. GAS WebApp呼び出し（承認後）

承認後、以下のHTTP POSTをGAS WebAppに送信する:

```bash
curl -X POST [GAS_WEBAPP_URL] \
  -H "Content-Type: application/json" \
  -d '{
    "action": "broadcast",
    "token": "[AUTH_TOKEN]",
    "cases": ["page_id_1", "page_id_2"],
    "staff": ["page_id_3"]
  }'
```

### 5. 配信結果の表示

GASからの応答を元に配信結果を表示:

```
配信完了しました

案件2件 × パートナー20社 = 40通送信
要員1件 × パートナー20社 = 40通送信（サマリー+スキルシート）
合計: 80通

※自社情報の除外: 3件
```

## スコアリング基準（v2）

### 案件（4軸 / 100点満点）

| 軸 | 配点 | 基準 |
|---|---|---|
| 単価の適正レンジ | 30点 | 65〜80万=30, 60-65/80-85=24, 55-60/85-90=18, 50-55/90-95=12, 範囲外=6, null=5 |
| 鮮度（新しさ） | 25点 | 3日以内=25, 7日以内=20, 14日以内=15, 30日以内=10, それ以上=5 |
| リモート可 | 25点 | フルリモート=25, リモートメイン=22, 週1出社=20, 週2-3出社=16, ハイブリッド=14, 常駐=6 |
| 開発言語のメジャー度 | 20点 | PHP/Java/JS/TS=20, Python/C#=15, Go=10, その他=5 |

### 要員（5軸 / 100点満点）

| 軸 | 配点 | 基準 |
|---|---|---|
| 年齢 | 25点 | 28-32歳=25, 26-27/33-35=20, 24-25/36-38=14, 39-42=8, 範囲外=3, 不明=8 |
| 単価の適正レンジ | 25点 | 65〜75万=25, 60-65/75-80=20, 55-60/80-85=14, 50-55/85-90=8, 範囲外=4, null=8 |
| 鮮度（新しさ） | 25点 | 3日以内=25, 7日以内=20, 14日以内=15, 30日以内=10, それ以上=5 |
| 開発言語のメジャー度 | 15点 | PHP/Java/JS/TS=15, Python/C#=11, Go=7, その他=3 |
| スキルシート有無 | 10点 | あり=10, なし=0 |

## 配信履歴（再配信防止）

- 配信実行後、配信済みのpage_idが `broadcast_history.json` に記録される
- 次回ピックアップ時、**7日以内に配信済みのものは自動除外**される
- これにより毎回異なる案件・要員がピックアップされる
- `--include-sent` オプションで除外をスキップ可能
- 履歴は7日経過で自動クリーンアップ

## 注意事項

- サマリーは全文表示する（営業判断のため）
- 要員のスキルシートの有無を明示する
- 配信は1件ずつ個別送信（まとめて送らない）
- 自社情報は配信先から除外する
