# 📊 SES営業レポート生成

**ユーザーが以下のコマンドを入力したときにこのスキルを実行:**

## 週次レポート
- `/weekly-report`
- `/週次レポート`

## 月次レポート
- `/monthly-report`
- `/月次レポート`

## 🎯 このスキルの目的

NotionのSES営業データベース（提案DB、要員DB、案件DB、営業コスト管理DB）からレポートを自動生成し、Markdownファイルとして保存、またはNotionページとして投稿します。

## 📋 処理フロー

### 週次レポート (`/weekly-report`)

1. **週開始日の確認**
   - ユーザーに週開始日を尋ねる（例: 2026-01-19）
   - フォーマット: YYYY-MM-DD

2. **レポート生成実行**
   ```bash
   cd C:\Users\user\claude-workspace\_skills\ses-analysis-skill
   python generate_weekly.py [週開始日] [--no-notion]
   ```
   - デフォルト: Notion投稿 + ファイル保存
   - `--no-notion`: Notion投稿をスキップ（ファイルのみ保存）

3. **結果の表示**
   - 生成されたMarkdownファイルのパスを表示
   - NotionページURLを表示

### 月次レポート (`/monthly-report`)

1. **対象月の確認**
   - ユーザーに対象月を尋ねる（例: 2026-01）
   - フォーマット: YYYY-MM

2. **出力先の確認**
   - Markdownファイルのみ生成するか、Notionにも投稿するか確認
   - オプション: `--notion`フラグ

3. **レポート生成実行**
   ```bash
   cd C:\Users\user\claude-workspace\_skills\ses-analysis-skill
   python generate_monthly.py [対象月] [--notion]
   ```

4. **結果の表示**
   - 生成されたMarkdownファイルのパスを表示
   - Notionに投稿した場合はページURLを表示

## 📊 レポート内容

### 週次レポート

#### 1. 営業コスト分析
- 週間稼働時間（前週差分から自動計算）
- 累積稼働時間、月間予算時間
- 予算消化率
- 実績金額・予算金額（時間単価: ¥3,750/h）

#### 2. 費用対効果（ROI）
- **アクション別バリュー**: 精査・打診・提案・面談・決定の件数 × 仮想単価
- **コスト vs バリュー**: バーチャート比較
- **総合ROI / プロセスROI（決定除外）**: 2つの指標を並列表示
- **月間累積ROI**: 週次でも月間累積を併記
- 仮想単価: 精査¥200、打診¥500、提案¥2,500、面談¥7,000、決定¥150,000

#### 3. 週次トレンド分析（コントロール可能な活動量）
- **活動量トレンド**: 提案/要員/案件の新規登録件数（棒グラフ・前週比較）
- **ステータス遷移率**: 提案中→面談の転換率（表形式）

#### 3. スキル需給マッチング分析
- 案件で求められているスキル（円グラフ）
- 要員の保有スキル（円グラフ）
- スキル需給一覧（TOP10）

#### 4. 期限超過アラート
- 提案DB: ステータス「提案中」で提案日から1週間以上経過
- 要員DB: ステータス≠「オファー・終了」で要員回収日から2週間以上経過
- 案件DB: ステータス≠「決定・終了」で案件回収日から2週間以上経過

#### 5. 活動サマリー
- 提案活動（週次ステータス別件数、決定案件一覧）
- 要員活動（週次ステータス別件数）
- 案件活動（週次ステータス別件数）

#### 6. 次週アクション
- 期限超過フォロー
- 営業活動
- データメンテナンス

---

### 月次レポート

#### 1. 営業コスト分析
- 月間累積稼働時間
- 月間予算時間、予算消化率
- 実績金額・予算金額（時間単価: ¥3,750/h）
- 週別稼働時間推移（棒グラフ）

#### 2. 月間費用対効果（ROI）
- **アクション別バリュー（月間累計）**: 精査・打診・提案・面談・決定
- **コスト vs バリュー**: バーチャート比較
- **総合ROI / プロセスROI（決定除外）**: 月間サマリー
- **週別ROI推移**: 折れ線グラフ + テーブル
- 仮想単価: 精査¥200、打診¥500、提案¥2,500、面談¥7,000、決定¥150,000

#### 3. 月次トレンド分析（コントロール可能な活動量）
- **活動量の週別推移**: 提案/要員/案件の新規登録件数（折れ線グラフ）
- **週別活動量サマリー**: 各週の登録件数と月間合計
- **ステータス遷移率**: 提案中→面談の月間平均転換率

#### 3. スキル需給マッチング分析（月末時点）
- 案件で求められているスキル（円グラフ）
- 要員の保有スキル（円グラフ）
- スキル需給一覧（TOP10）
- 供給過多・供給不足スキルの表示

#### 4. 月次振り返りと次月アクション
- 今月の成果（良かった点・改善が必要な点）
- 次月の重点施策

## 💡 使用例

### 週次レポート

#### 例1: 通常実行（Notion投稿 + ファイル保存）
```
ユーザー: /weekly-report 2026-01-19

アシスタント: [generate_weekly.py 2026-01-19 を実行]
✅ レポートを weekly_report_2026_01_19.md に保存しました
✅ Notionに投稿しました: https://notion.so/...
```

#### 例2: ファイルのみ生成（Notion投稿なし）
```
ユーザー: /weekly-report 2026-01-19 --no-notion

アシスタント: [generate_weekly.py 2026-01-19 --no-notion を実行]
✅ レポートを weekly_report_2026_01_19.md に保存しました
```

---

### 月次レポート

#### 例1: Markdownファイルのみ生成
```
ユーザー: /monthly-report

アシスタント: 月次レポートを生成します。対象月を入力してください（例: 2026-01）

ユーザー: 2026-01

アシスタント: [generate_monthly.py 2026-01 を実行]
✅ レポートを monthly_report_2026_01.md に保存しました
```

#### 例2: Notionにも投稿
```
ユーザー: /monthly-report

アシスタント: 月次レポートを生成します。対象月を入力してください（例: 2026-01）

ユーザー: 2026-01

アシスタント: Notionにも投稿しますか？

ユーザー: はい

アシスタント: [generate_monthly.py 2026-01 --notion を実行]
✅ レポートを monthly_report_2026_01.md に保存しました
✅ Notionに投稿しました: https://notion.so/...
```

## ⚠️ 注意事項

- Notion APIキーが正しく設定されていることを確認
- 週開始日は月曜日を推奨
- グラフ画像はQuickChart.ioの外部URLとして埋め込まれます
- Notionページ作成時は最大100ブロックずつ追加されます

## 🔧 技術仕様

- **言語**: Python 3
- **依存ライブラリ**: requests, datetime
- **Notion API**: v2022-06-28
- **グラフ生成**: QuickChart.io
- **文字エンコーディング**: UTF-8

## 📌 バージョン

v1.1.0 - 月次レポート対応
- `/monthly-report` コマンド追加
- 月次トレンド分析（週別推移の折れ線グラフ）
- 月次振り返りと次月アクション

v1.0.0 - 初回リリース
- コントロール可能な活動量に基づくトレンド分析
- スキル需給マッチング分析
- Notion投稿機能
