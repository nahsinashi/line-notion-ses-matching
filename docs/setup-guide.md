# セットアップガイド

LINE x Notion マッチングシステムを一から構築するための手順書です。

---

## 前提条件

以下のアカウントが必要です（全て無料プランで開始可能）。

| サービス | 用途 | 費用目安 |
|---------|------|---------|
| [Google アカウント](https://accounts.google.com/) | GAS（Google Apps Script）実行環境 | 無料 |
| [Notion](https://www.notion.so/) | データベース | 無料〜 |
| [LINE Developers](https://developers.line.biz/) | LINE Bot | 無料（月200通まで） |
| [Google AI Studio](https://aistudio.google.com/) | Gemini API（AI整形・マッチング） | 無料枠あり |
| [OpenAI](https://platform.openai.com/) | GPT-4o-mini（コマンド解析、オプション） | 従量課金 |

### 月額コスト目安

| 項目 | 費用 |
|------|------|
| LINE Messaging API | 無料（月200通）〜 月5,000円（月5,000通） |
| Gemini API | ほぼ無料（無料枠内で収まることが多い） |
| OpenAI API | 月100〜500円程度（GPT-4o-mini利用） |
| Notion | 無料〜 |

---

## 全体の流れ

```
Step 1: Notion データベース作成（30分）
Step 2: LINE Bot 作成（20分）
Step 3: AI API キー取得（15分）
Step 4: メインGAS プロジェクト作成（30分）
Step 5: 管理者GAS プロジェクト作成（20分）
Step 6: LINE Webhook 接続（10分）
Step 7: Googleフォーム作成（30分）
Step 8: トリガー設定（10分）
Step 9: 動作確認（15分）
```

合計: 約3時間

### 利用者の役割

| 役割 | 入力経路 | 主な操作 |
|------|---------|---------|
| **管理者** | Googleフォーム / Notion直接 / 管理者LINE Bot | 案件・要員の手動登録、ステータス変更、提案管理、フォーム管理 |
| **メンバー** | Googleフォーム | 案件・要員の登録、ステータス変更 |
| **パートナー** | LINE（パートナー用Bot） | 案件・要員情報の送信（テキスト・ファイル） |

> **管理者**はフォームの選択肢更新やNotionの管理を行います。**メンバー**はGoogleフォームから案件・要員を登録できます。

---

## Step 1: Notion データベース作成

### 1-1. Notion Integration（API連携）の作成

1. [Notion Integrations](https://www.notion.so/my-integrations) にアクセス
2. 「新しいインテグレーション」をクリック
3. 以下を設定:
   - **名前**: `LINE-Notionマッチング`（任意）
   - **関連ワークスペース**: 自分のワークスペースを選択
   - **機能**: 「コンテンツを読み取る」「コンテンツを挿入する」「コンテンツを更新する」全てチェック
4. 「送信」をクリック
5. **Internal Integration Secret** をコピーして保管（`ntn_` で始まる文字列）

> これが `NOTION_API_KEY` になります。

### 1-2. データベースの作成

[docs/notion-schema.md](./notion-schema.md) を参照して、以下の4つのデータベースを作成してください。

| DB名 | 必須 | 説明 |
|------|------|------|
| 案件DB | 必須 | SES案件情報 |
| 要員DB | 必須 | エンジニア情報 |
| 提案DB | 必須 | マッチング提案 |
| ステータス変更履歴DB | 任意 | 変更追跡 |

#### 作成手順（各DBごと）

1. Notionでワークスペースのトップレベルに新しいページを作成
2. `/database` と入力し「データベース - フルページ」を選択
3. データベース名を入力（例: `案件DB`）
4. [notion-schema.md](./notion-schema.md) の定義に従ってプロパティを追加

#### 作成順序の注意

提案DBは案件DBと要員DBへの**リレーション**を持つため、**案件DB → 要員DB → 提案DB** の順に作成してください。

### 1-3. Integration にデータベースを共有

各データベースで以下を実行:

1. データベースページ右上の「...」メニュー → 「コネクト」
2. Step 1-1 で作成した Integration を選択
3. 「確認」をクリック

> この作業をしないとAPIからアクセスできません。全DBで実行してください。

### 1-4. データベースIDの取得

1. ブラウザでデータベースページを開く
2. URLの `notion.so/` 以降がデータベースID

```
https://www.notion.so/ワークスペース名/2c2c01f8776980138dc0ea41dac2c119?v=...
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                      ↑ これがデータベースID
```

3. 4つのDBのIDをメモしておく

---

## Step 2: LINE Bot 作成

2つのLINE Botが必要です（パートナー向け + 管理者向け）。

### 2-1. LINE Developersコンソールでプロバイダー作成

1. [LINE Developers](https://developers.line.biz/) にログイン
2. 「プロバイダー」→「作成」
3. プロバイダー名を入力（例: `SESマッチング`）

### 2-2. パートナー向けチャネル作成

1. プロバイダー配下で「新規チャネル作成」→「Messaging API」
2. 以下を設定:
   - **チャネル名**: パートナー向けの名前（例: `SES案件受付`）
   - **チャネル説明**: 任意
3. 作成後、「Messaging API設定」タブで:
   - **チャネルアクセストークン**: 「発行」をクリックしてコピー
   - **Webhook設定**: 後で設定（Step 6）
   - **応答メッセージ**: オフ
   - **あいさつメッセージ**: 任意

### 2-3. 管理者向けチャネル作成

同様の手順で2つ目のチャネルを作成。
- **チャネル名**: 管理者向けの名前（例: `SES管理`）

### 2-4. メモしておく情報

| 項目 | パートナー用 | 管理者用 |
|------|------------|---------|
| チャネルアクセストークン | ○ | ○ |
| チャネルシークレット | ○ | ○ |

---

## Step 3: AI API キー取得

### 3-1. Gemini API キー（必須）

1. [Google AI Studio](https://aistudio.google.com/) にアクセス
2. 左メニューの「Get API key」→「Create API key」
3. APIキーをコピーして保管

### 3-2. OpenAI API キー（推奨）

1. [OpenAI Platform](https://platform.openai.com/) にアクセス
2. 「API keys」→「Create new secret key」
3. APIキーをコピーして保管

> GPT-4o-mini を管理者コマンド解析・返答判定に使用。なくてもGemini Flashで代替可能。

### 3-3. Claude API キー（オプション）

1. [Anthropic Console](https://console.anthropic.com/) にアクセス
2. 「API Keys」→「Create Key」
3. APIキーをコピーして保管

> フォールバック用。なくても動作します。

---

## Step 4: メインGAS プロジェクト作成

### 4-1. GASプロジェクト作成

1. [Google Apps Script](https://script.google.com/) にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を変更（例: `LINE-Notion-Main`）

### 4-2. ファイルの作成

左サイドバーの「+」→「スクリプト」で、以下のファイルを作成し、`gas-main/` フォルダ内の各 `.gs` ファイルの内容を貼り付けます。

| 作成するファイル名 | コピー元 |
|-----------------|---------|
| `00_設定` | `gas-main/00_設定.gs` ← **各値を自分の環境に書き換え（後述）** |
| `01_フォーム送信時の処理スクリプト` | `gas-main/01_フォーム送信時の処理スクリプト.gs` |
| `02_フォーム選択肢更新スクリプト` | `gas-main/02_フォーム選択肢更新スクリプト.gs` |
| `03_AI整形` | `gas-main/03_AI整形.gs` |
| `04_マッチング` | `gas-main/04_マッチング.gs` |
| `05_WebApp` | `gas-main/05_WebApp.gs` |
| `06_LINEマッピング` | `gas-main/06_LINEマッピング.gs` |
| `07_ファイル受信処理` | `gas-main/07_ファイル受信処理.gs` |
| `08_LINE通知` | `gas-main/08_LINE通知.gs` |
| `09_ステータス監視` | `gas-main/09_ステータス監視.gs` |
| `10_定期配信` | `gas-main/10_定期配信.gs` |

> **注意**: GASではファイル名に `.gs` は不要です。拡張子は自動付与されます。

### 4-3. `00_設定.gs` の書き換え

`00_設定.gs` に全ての設定値が集約されています。`YOUR_〜` のプレースホルダーを自分の環境の値に書き換えてください。

| 変数名 | 書き換える値 | 取得元 |
|--------|------------|--------|
| `NOTION_API_KEY` | `ntn_xxxxx...` | Step 1-1 |
| `FORM_ID` | Googleフォームの ID | Step 4-6（後述） |
| `CASE_DB_ID` | 案件DBのID（ハイフン付き） | Step 1-4 |
| `STAFF_DB_ID` | 要員DBのID（ハイフン付き） | Step 1-4 |
| `PROPOSAL_DB_ID` | 提案DBのID（ハイフン付き） | Step 1-4 |
| `CLAUDE_API_KEY` | `sk-ant-xxxxx...`（オプション） | Step 3 |
| `GEMINI_API_KEY` | `AIzaSy...` | Step 3-1 |
| `PROMPT_SHEET_ID` | プロンプト管理スプレッドシートのID | Step 4-4（後述） |

### 4-3b. スクリプトプロパティの設定

一部の設定はスクリプトプロパティからも読み込みます。
GASエディタの「⚙ プロジェクトの設定」→「スクリプトプロパティ」で以下を追加:

| プロパティ名 | 値 | 取得元 |
|------------|-----|--------|
| `LINE_CHANNEL_ACCESS_TOKEN` | パートナー用トークン | Step 2-2 |
| `STATUS_HISTORY_DB_ID` | ステータス変更履歴DBのID | Step 1-4 |
| `ADMIN_LINE_USER_ID` | 管理者のLINE UserID | 後述 |
| `SKILLSHEET_FOLDER_ID` | Google DriveフォルダID | Step 4-5 |

### 4-4. AIプロンプトの設定

1. Googleスプレッドシートを新規作成
2. シート1のセルに以下を設定:
   - **B1**: `prompts/案件整形プロンプト.txt` の内容を貼り付け
   - **B2**: `prompts/要員整形プロンプト.txt` の内容を貼り付け
   - **B3**: `prompts/マッチングプロンプト.txt` の内容を貼り付け
3. スプレッドシートのURLからIDを取得
4. スクリプトプロパティに追加:

| プロパティ名 | 値 |
|------------|-----|
| `PROMPT_SHEET_ID` | スプレッドシートのID |

### 4-5. Google Drive フォルダ作成

1. Google Driveで「スキルシート」フォルダを新規作成
2. フォルダURLからIDを取得（`folders/` 以降の文字列）
3. スクリプトプロパティに追加（Step 4-3b で設定済みの場合はスキップ）:

| プロパティ名 | 値 |
|------------|-----|
| `SKILLSHEET_FOLDER_ID` | DriveフォルダID |

### 4-6. Webアプリとしてデプロイ

1. GASエディタ右上の「デプロイ」→「新しいデプロイ」
2. 種類: 「ウェブアプリ」
3. 設定:
   - **説明**: `v1.0`（任意）
   - **実行するユーザー**: 自分
   - **アクセスできるユーザー**: 全員
4. 「デプロイ」をクリック
5. **ウェブアプリのURL**をコピーして保管（`https://script.google.com/macros/s/xxxxx/exec`）

> これがパートナー用の **メインGAS WebApp URL** です。

---

## Step 5: 管理者GAS プロジェクト作成

### 5-1. 新しいGASプロジェクト作成

Step 4と同様に新しいプロジェクトを作成（例: `LINE-Notion-Admin`）

### 5-2. ファイルの作成

| 作成するファイル名 | コピー元 |
|-----------------|---------|
| `00_Config` | `gas-admin/00_Config.gs` |
| `01_WebApp` | `gas-admin/01_WebApp.gs` |
| `02_AdminCommands` | `gas-admin/02_AdminCommands.gs` |
| `03_ApprovalFlow` | `gas-admin/03_ApprovalFlow.gs` |
| `04_AI_Clients` | `gas-admin/04_AI_Clients.gs` |

### 5-3. コードの修正

#### `00_Config.gs` の修正

ハードコードされたAPIキーを削除し、スクリプトプロパティのみを使うように変更:

```javascript
// 変更前（削除する行）
const LINE_CHANNEL_ACCESS_TOKEN = PropertiesService.getScriptProperties().getProperty('LINE_CHANNEL_ACCESS_TOKEN')
  || 'ハードコードされたトークン';
const LINE_CHANNEL_SECRET = 'ハードコードされたシークレット';

// 変更後
const LINE_CHANNEL_ACCESS_TOKEN = PropertiesService.getScriptProperties().getProperty('LINE_CHANNEL_ACCESS_TOKEN');
const LINE_CHANNEL_SECRET = PropertiesService.getScriptProperties().getProperty('LINE_CHANNEL_SECRET');
```

#### `01_WebApp.gs` の修正

`EXISTING_GAS_URL` をStep 4-6で取得したメインGASのURLに変更:

```javascript
const EXISTING_GAS_URL = 'ここにStep 4-6のURLを貼り付け';
```

### 5-4. スクリプトプロパティの設定

| プロパティ名 | 値 | 取得元 |
|------------|-----|--------|
| `LINE_CHANNEL_ACCESS_TOKEN` | 管理者用トークン | Step 2-3 |
| `LINE_CHANNEL_SECRET` | 管理者用シークレット | Step 2-3 |
| `GEMINI_API_KEY` | Gemini APIキー | Step 3-1 |
| `OPENAI_API_KEY` | OpenAI APIキー | Step 3-2 |
| `CLAUDE_API_KEY` | Claude APIキー（オプション） | Step 3-3 |
| `ADMIN_LINE_USER_ID` | 管理者のLINE UserID | 後述 |
| `NOTION_API_KEY` | Notion APIキー | Step 1-1 |
| `CASE_DB_ID` | 案件DBのID | Step 1-4 |
| `STAFF_DB_ID` | 要員DBのID | Step 1-4 |
| `PROPOSAL_DB_ID` | 提案DBのID | Step 1-4 |

### 5-5. Webアプリとしてデプロイ

Step 4-6 と同じ手順でデプロイ。

> これが **管理者GAS WebApp URL** です。

---

## Step 6: LINE Webhook 接続

### 6-1. 管理者LINE UserID の取得

1. 管理者GASをデプロイ済みの状態で、管理者用LINE Botに何かメッセージを送る
2. GASの「実行数」ログを確認し、受信した `userId` をメモ
3. メインGAS・管理者GASの両方のスクリプトプロパティに `ADMIN_LINE_USER_ID` として設定

### 6-2. Webhook URL 設定

#### パートナー用チャネル
1. LINE Developers → パートナー用チャネル → 「Messaging API設定」
2. Webhook URL: **メインGAS WebApp URL**（Step 4-6）を貼り付け
3. 「Webhookの利用」をオン
4. 「検証」ボタンで接続確認

#### 管理者用チャネル
1. LINE Developers → 管理者用チャネル → 「Messaging API設定」
2. Webhook URL: **管理者GAS WebApp URL**（Step 5-5）を貼り付け
3. 「Webhookの利用」をオン
4. 「検証」ボタンで接続確認

---

## Step 7: Googleフォーム作成

管理者・メンバーがブラウザから案件・要員を登録するためのフォームです。

> **重要**: フォーム経由の登録はLINE経由と同じNotion登録・AI整形・マッチング処理を使用します。

### 7-1. フォームの新規作成

1. [Google Forms](https://docs.google.com/forms/) にアクセス
2. 「空白のフォーム」を作成
3. フォームタイトルを設定（例: `SES 案件・要員管理`）

### 7-2. フォームIDの取得

1. フォームのURLからIDを取得:

```
https://docs.google.com/forms/d/1aBcDeFgHiJkLmNoPqRsTuVwXyZ/edit
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                 ↑ これがフォームID
```

2. メインGASの `00_設定.gs` の `FORM_ID` に設定

### 7-3. セクションと質問の作成

フォームは**セクション分岐**を使って、登録タイプに応じて表示する質問を切り替えます。

#### セクション1: 登録タイプの選択

| 質問名 | 項目タイプ | 設定 |
|--------|----------|------|
| **登録タイプ** | プルダウン | 下記の選択肢を設定 |

**「登録タイプ」の選択肢**:

| 選択肢 | セクション分岐先 |
|--------|---------------|
| 案件を登録 | → セクション2（案件・要員登録） |
| 要員を登録 | → セクション2（案件・要員登録） |
| 提案を登録 | → セクション3（提案登録） |
| 提案ステータスを変更 | → セクション4（提案ステータス変更） |
| 案件ステータスを変更 | → セクション5（案件ステータス変更） |
| 要員ステータスを変更 | → セクション6（要員ステータス変更） |

> **セクション分岐の設定方法**: 登録タイプの質問の右下「...」メニュー → 「回答に応じてセクションに移動」をオン → 各選択肢の横に移動先セクションを指定

#### セクション2: 案件・要員登録

「案件を登録」「要員を登録」共通のセクションです。

| 質問名 | 項目タイプ | 必須 | 説明 |
|--------|----------|------|------|
| **担当者** | プルダウン | はい | 初期値: `髙梨`, `坂本`, `堀江`（自社メンバーに変更） |
| **企業名** | 記述式（短文） | いいえ | パートナー企業名 |
| **原文** | 段落（長文） | はい | 案件/要員の原文テキスト |
| **スキルシート** | ファイルアップロード | いいえ | 要員登録時に使用 |

> **ファイルアップロードの注意**: フォームにファイルアップロード質問を追加すると、**フォーム全体がGoogleログイン必須**になります。社内メンバーのみが使用する前提のため問題ありませんが、外部向けにはLINE経由の登録を案内してください。

セクション末尾の移動先: 「フォームを送信」

#### セクション3: 提案登録

| 質問名 | 項目タイプ | 必須 | 説明 |
|--------|----------|------|------|
| **既存案件を選択** | プルダウン | はい | GASトリガーで自動更新される（営業中の案件一覧） |
| **既存要員を選択** | プルダウン | はい | GASトリガーで自動更新される（営業中の要員一覧） |
| **メモ** | 段落（長文） | いいえ | 提案に関するメモ |

> **選択肢の自動更新**: 「既存案件を選択」「既存要員を選択」の選択肢はGASのトリガー（15分おき）でNotionのデータから自動更新されます。初回は仮の選択肢（例: `初期値`）を1つ入れておいてください。

セクション末尾の移動先: 「フォームを送信」

#### セクション4: 提案ステータス変更

| 質問名 | 項目タイプ | 必須 | 説明 |
|--------|----------|------|------|
| **対象提案を選択** | プルダウン | はい | GASトリガーで自動更新される |
| **新しい提案ステータス** | プルダウン | はい | `提案中` / `面談` / `結果待ち` / `見送り` / `辞退` / `決定` |
| **面談設定日** | 日付 | いいえ | 面談日程（ステータスを「面談」にする場合） |
| **メモ** | 段落（長文） | いいえ | 変更理由や備考（既存メモに追記される） |

セクション末尾の移動先: 「フォームを送信」

#### セクション5: 案件ステータス変更

| 質問名 | 項目タイプ | 必須 | 説明 |
|--------|----------|------|------|
| **対象案件を選択** | プルダウン | はい | GASトリガーで自動更新される（「終了」以外の案件） |
| **新しい案件ステータス** | プルダウン | はい | `未処理` / `営業中` / `面談調整中` / `決定` / `終了` |

セクション末尾の移動先: 「フォームを送信」

#### セクション6: 要員ステータス変更

| 質問名 | 項目タイプ | 必須 | 説明 |
|--------|----------|------|------|
| **対象要員を選択** | プルダウン | はい | GASトリガーで自動更新される（「終了」以外の要員） |
| **新しい要員ステータス** | プルダウン | はい | `営業中` / `面談調整中` / `オファー` / `終了` |

セクション末尾の移動先: 「フォームを送信」

### 7-4. フォーム設定

1. フォーム上部の「設定」（⚙アイコン）をクリック
2. 以下を確認:
   - **メールアドレスを収集する**: 任意（社内運用なら不要）
   - **回答を1回に制限する**: オフ（同じ人が複数回送信できるように）
   - **編集を許可する**: オフ

### 7-5. GASとフォームの接続

1. メインGASエディタに戻る
2. `00_設定.gs` の `FORM_ID` にStep 7-2で取得したIDを設定
3. GASエディタの上部で `setFormSubmitTrigger` 関数を選択し、「▶ 実行」をクリック
4. 初回は権限の承認が求められるので許可する
5. ログに `✅ フォーム送信トリガーを設定しました` と表示されれば成功

### 7-6. 選択肢の初期同期

1. GASエディタで `updateFormChoices` 関数を選択し、「▶ 実行」
2. Notionのデータがフォームのプルダウンに反映される
3. 以後は15分おきのトリガーで自動更新される

---

## Step 8: トリガー設定

### メインGAS プロジェクト

GASエディタで「トリガー」（時計アイコン）→「トリガーを追加」:

| 関数 | イベントソース | 間隔 | 用途 |
|------|-------------|------|------|
| `updateFormChoicesWithTimeCheck` | 時間主導型 | 15分おき | フォーム選択肢の更新 |
| `watchAllStatusChanges` | 時間主導型 | 15分おき | ステータス変更監視 |
| `processTimeoutStaffData` | 時間主導型 | 5分おき | タイムアウトした一時保存データの処理 |

> **注意**: `onFormSubmit` トリガーはStep 7-5で設定済みです。ここで重複して追加しないでください。

---

## Step 9: 動作確認

### チェックリスト

以下の順序でテストしてください。

#### 基本接続

- [ ] 管理者用LINE Botにメッセージ送信 → GASのログに表示される
- [ ] パートナー用LINE Botにメッセージ送信 → GASのログに表示される
- [ ] `ヘルプ` と管理者LINE Botに送信 → ヘルプメッセージが返る

#### LINE UserID マッピング

1. GASエディタで以下を実行:
```javascript
addLineUserMapping("Uxxxxxxxxxx", "テスト株式会社")
```
2. `showCurrentMapping()` で確認

#### 案件登録

1. パートナー用LINE Botに案件情報テキストを送信
2. 確認ポイント:
   - [ ] Notion案件DBに新しいページが作成される
   - [ ] ステータスが「未処理」→「営業中」に変わる
   - [ ] サマリーがAI整形される
   - [ ] スキル要件が抽出される

#### 要員登録（テキスト→ファイル）

1. パートナー用LINE Botに要員情報テキストを送信
2. 30秒以内にスキルシートPDFを送信
3. 確認ポイント:
   - [ ] テキストとファイルが紐付いてNotion要員DBに登録される
   - [ ] スキルシートがGoogle Driveに保存される
   - [ ] Notionのスキルシートプロパティにファイルが添付される

#### マッチング

1. 案件と要員がそれぞれ1件以上、ステータス「営業中」で存在する状態にする
2. 新しい案件または要員を登録
3. 確認ポイント:
   - [ ] 提案DBに候補が自動作成される
   - [ ] 管理者LINE Botに承認/却下ボタン付き通知が届く
   - [ ] 同一情報元（案件元企業＝要員元企業）の組み合わせがマッチングされていないこと

#### 承認ワークフロー

1. 管理者LINE Botに届いた通知の「承認」ボタンをタップ
2. 確認ポイント:
   - [ ] パートナーに案件詳細がLINE送信される
   - [ ] 提案DBのステータスが「提案中」に変わる

#### フォーム経由の登録（メンバー利用）

1. Googleフォームを開き「案件を登録」を選択
2. 担当者・企業名・原文を入力して送信
3. 確認ポイント:
   - [ ] Notion案件DBに新しいページが作成される
   - [ ] AI整形・マッチングが自動実行される
4. フォームを再度開き「提案を登録」を選択
5. 既存案件・既存要員のプルダウンに選択肢が表示されることを確認
6. 確認ポイント:
   - [ ] 提案DBに候補が作成される

---

## トラブルシューティング

### よくあるエラー

| 症状 | 原因 | 対処法 |
|------|------|--------|
| Webhook検証が失敗する | GASのデプロイURLが間違っている | 「新しいデプロイ」で再デプロイし、新しいURLを使用 |
| Notionに登録されない | Integration がDBに共有されていない | Step 1-3 を再確認 |
| AI整形が動かない | GEMINI_API_KEY が未設定 or 無効 | Google AI Studioで新しいキーを発行 |
| マッチングが動かない | PROMPT_SHEET_ID が未設定 | スプレッドシートIDを確認 |
| LINE通知が来ない | ADMIN_LINE_USER_ID が間違っている | GASログでUserIDを再確認 |
| 「除外」と判定される | AI判定が厳しすぎる | `01_WebApp.gs` の `buildJudgmentPrompt()` を調整 |
| フォームの選択肢が空 | トリガー未設定 or Notionに対象データなし | `updateFormChoices()` を手動実行して確認 |
| フォーム送信しても登録されない | フォーム送信トリガーが未設定 | `setFormSubmitTrigger()` を再実行 |
| フォームがログイン必須になった | ファイルアップロード質問がある | 仕様上の制限。社内メンバーのみ利用 |

### GASのデプロイに関する注意

- コードを変更した後は**必ず再デプロイ**が必要
- 「デプロイを管理」→ 既存デプロイの鉛筆アイコン → バージョンを「新バージョン」に → 「デプロイ」
- URLは変わりません（同じデプロイを更新する場合）

### ログの確認方法

1. GASエディタの左メニュー「実行数」をクリック
2. 各実行の詳細を展開してログを確認
3. エラーがある場合は赤字で表示される

---

## カスタマイズ

### 担当者名を変更する

以下の箇所を変更:
- Notion各DBの「担当」select選択肢
- `08_LINE通知.gs` の管理者フィルタ条件（`"髙梨"` を変更）

### 除外条件を変更する

`gas-admin/01_WebApp.gs` の `buildJudgmentPrompt()` 内の除外ルールを編集

#### 現在の要員追加除外条件（AI判定）

1. 外国籍の要員
2. インフラ系スキルのみ
3. 地方在住（東京・神奈川・千葉・埼玉以外）
4. 経験年数2年半未満
5. 希望単価90万円超
6. ヘルプデスク、運用監視、保守のみ
7. データ基盤・ETL系スキルのみ
8. DevOps/SRE/プラットフォーム系スキルのみ
9. フリーランスの要員（「フリーランス」「個人事業主」「フリー」「FL」等）

### マッチングの除外ルール

`gas-main/04_マッチング.gs` の `isSameSource()` で制御

- **同一情報元の除外**: 案件元企業と要員元企業が同じ場合、マッチング対象外
  - 例: サウンズから届いた案件 × サウンズから届いた要員 → スキップ
  - 「株式会社」「（株）」「合同会社」等の表記揺れは自動吸収

### AI モデルを変更する

- `gas-main/03_AI整形.gs`: `formatWithGemini()` のモデル名
- `gas-main/04_マッチング.gs`: `callGeminiProForMatching()` / `callGeminiFlashForMatching()` のモデル名
- `gas-admin/04_AI_Clients.gs`: 各AIクライアント関数のモデル名
